<!DOCTYPE html>
<html lang="ja">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>YOKO's Garden ğŸ¯</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>

    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>

        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

        }

        body {

            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', sans-serif;

            background: linear-gradient(135deg, #fff5f5 0%, #ffe4e1 50%, #ffd4c8 100%);

            min-height: 100vh;

            padding: 0;

            overflow-x: hidden;

            -webkit-tap-highlight-color: transparent;

        }

        #root {

            max-width: 480px;

            margin: 0 auto;

            min-height: 100vh;

            background: white;

            box-shadow: 0 0 40px rgba(255, 140, 0, 0.1);

        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */

        .header {

            background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%);

            color: white;

            padding: 20px;

            text-align: center;

            border-radius: 0 0 30px 30px;

            box-shadow: 0 4px 20px rgba(255, 140, 0, 0.3);

            position: relative;

        }

        .header h1 {

            font-size: 24px;

            margin-bottom: 10px;

            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);

        }

        .stats-container {

            display: flex;

            justify-content: space-around;

            margin-top: 15px;

            gap: 10px;

            padding-right: 120px;

        }

        .stat-box {

            background: rgba(255, 255, 255, 0.3);

            padding: 10px 15px;

            border-radius: 15px;

            backdrop-filter: blur(10px);

            flex: 1;

        }

        .stat-label {

            font-size: 11px;

            opacity: 0.9;

            margin-bottom: 3px;

        }

        .stat-value {

            font-size: 20px;

            font-weight: bold;

        }

        /* ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ãƒˆã‚°ãƒ« */
        .music-toggle {
            position: absolute;
            right: 12px;
            top: 12px;
            background: rgba(255,255,255,0.25);
            border: 0;
            color: #fff;
            padding: 8px 12px;
            border-radius: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }
        .music-toggle:active { transform: translateY(1px); }

        /* è™ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ */

        .tiger-container {

            padding: 30px 20px;

            text-align: center;

            position: relative;

        }

        .tiger {

            font-size: 120px;

            animation: float 3s ease-in-out infinite;

            filter: drop-shadow(0 10px 20px rgba(255, 140, 0, 0.3));

            cursor: pointer;

            transition: transform 0.3s ease;

        }

        /* CSS-drawn Tiger */
        .tiger-box {
            width: 96px;
            height: 96px;
            background: linear-gradient(180deg, #ffcc66 0%, #ffa726 100%);
            border-radius: 20px;
            position: relative;
            display: inline-block;
            box-shadow: 0 12px 24px rgba(255, 140, 0, .25);
            animation: float 5s ease-in-out infinite;
        }
        .tiger-box::before,
        .tiger-box::after{
            content: "";
            position: absolute;
            top: -12px;
            width: 26px; height: 26px;
            background: linear-gradient(180deg, #ffcc66 0%, #ffa726 100%);
            border-radius: 8px;
            box-shadow: inset 0 -4px 0 rgba(255,255,255,.35);
        }
        .tiger-box::before{ left: 10px; transform: rotate(-15deg); }
        .tiger-box::after{ right: 10px; transform: rotate(15deg); }
        .tiger-box .stripes{
            position: absolute; inset: 0;
            background:
                linear-gradient(90deg, transparent 38%, #2d2a26 40%, transparent 42%) 0 24px/100% 8px no-repeat,
                linear-gradient(90deg, transparent 58%, #2d2a26 60%, transparent 62%) 0 38px/100% 8px no-repeat;
            opacity: .25;
            mix-blend-mode: multiply;
            pointer-events: none;
        }
        .tiger-box .face{ position:absolute; inset:0; display:grid; place-items:center; }
        .tiger-box .eyes{ display:flex; gap:18px; margin-top:6px; }
        .tiger-box .eye{ width:10px; height:10px; background:#2d2a26; border-radius:50%; box-shadow:0 0 0 2px #fff6, 0 8px 0 -3px #2d2a26; transition: transform .2s ease; }
        .tiger-box .nose{ width:14px; height:10px; background:#2d2a26; border-radius:50% 50% 60% 60%/50% 50% 80% 80%; margin:6px auto 0; }
        .tiger-box .whiskers{ width:56px; height:12px; position:relative; margin:4px auto 0; }
        .tiger-box .whiskers::before,.tiger-box .whiskers::after{ content:""; position:absolute; inset:0; border-top:2px solid #2d2a26; transform:translateY(4px);} 
        .tiger-box .whiskers::after{ transform:translateY(8px); opacity:.7; }
        .tiger-box .mouth{ width:26px; height:12px; border-bottom:4px solid #2d2a26; border-radius:0 0 26px 26px; margin:2px auto 0; opacity:0; transition:opacity .2s ease; }
        .tiger-box .cheek{ position:absolute; top:56px; width:12px; height:12px; background:#ffb3c1; border-radius:50%; opacity:0; }
        .tiger-box .cheek.left{ left:18px; }
        .tiger-box .cheek.right{ right:18px; }
        /* moods */
        .tiger-box.mood-sleepy .eye{ transform: scaleY(0.25); box-shadow: none; }
        .tiger-box.mood-happy .mouth{ opacity:1; }
        .tiger-box.mood-love .cheek{ opacity:1; }
        .tiger-box.mood-star{ box-shadow: 0 0 0 3px #ffd280 inset, 0 12px 24px rgba(255, 140, 0, .35); }

        .tiger:active {

            transform: scale(0.95);

        }

        .tiger.celebrating {

            animation: celebrate 0.5s ease;

        }

        @keyframes float {

            0%, 100% { transform: translateY(0px); }

            50% { transform: translateY(-10px); }

        }

        @keyframes celebrate {

            0%, 100% { transform: scale(1) rotate(0deg); }

            25% { transform: scale(1.2) rotate(-10deg); }

            75% { transform: scale(1.2) rotate(10deg); }

        }

        .tiger-message {

            font-size: 16px;

            color: #ff6b6b;

            margin-top: 10px;

            min-height: 24px;

            font-weight: 500;

        }

        .level-badge {

            display: inline-block;

            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);

            color: #ff6b6b;

            padding: 8px 20px;

            border-radius: 20px;

            font-weight: bold;

            font-size: 14px;

            margin-top: 10px;

            box-shadow: 0 4px 10px rgba(255, 215, 0, 0.4);

        }

        /* çµŒé¨“å€¤ãƒãƒ¼ */

        .exp-bar-container {

            margin: 20px;

            background: #ffe4e1;

            border-radius: 20px;

            height: 30px;

            overflow: hidden;

            position: relative;

            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);

        }

        .exp-bar {

            height: 100%;

            background: linear-gradient(90deg, #ff9a56 0%, #ff6b6b 100%);

            transition: width 0.5s ease;

            display: flex;

            align-items: center;

            justify-content: center;

            color: white;

            font-weight: bold;

            font-size: 12px;

        }

        /* ã‚¿ãƒ– */

        .tabs {

            display: flex;

            background: #fff5f5;

            border-bottom: 2px solid #ffe4e1;

        }

        .tab {

            flex: 1;

            padding: 15px;

            text-align: center;

            border: none;

            background: transparent;

            cursor: pointer;

            font-size: 14px;

            font-weight: 500;

            color: #999;

            transition: all 0.3s ease;

        }

        .tab.active {

            color: #ff6b6b;

            background: white;

            border-bottom: 3px solid #ff6b6b;

        }

        /* ç¿’æ…£ãƒªã‚¹ãƒˆ */

        .habits-list {

            padding: 20px;

        }

        .habit-card {

            background: white;

            border-radius: 20px;

            padding: 20px;

            margin-bottom: 15px;

            box-shadow: 0 4px 15px rgba(0,0,0,0.05);

            border: 2px solid #ffe4e1;

            transition: all 0.3s ease;

        }

        .habit-card.completed {

            background: linear-gradient(135deg, #fff5f5 0%, #ffe4e1 100%);

            border-color: #ff9a56;

        }

        .habit-header {

            display: flex;

            align-items: center;

            gap: 15px;

            margin-bottom: 10px;

        }

        .habit-icon {

            font-size: 32px;

            flex-shrink: 0;

        }

        .habit-info {

            flex: 1;

        }

        .habit-name {

            font-size: 16px;

            font-weight: bold;

            color: #333;

            margin-bottom: 5px;

        }

        .habit-frequency {

            font-size: 12px;

            color: #999;

        }

        .habit-footer {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-top: 10px;

        }

        .habit-points {

            font-size: 14px;

            color: #ff9a56;

            font-weight: bold;

        }

        .check-button {

            background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%);

            color: white;

            border: none;

            padding: 10px 25px;

            border-radius: 20px;

            font-weight: bold;

            cursor: pointer;

            transition: all 0.3s ease;

            font-size: 14px;

            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);

        }

        .check-button:active {

            transform: scale(0.95);

        }

        .check-button.completed {

            background: #ddd;

            color: #999;

            box-shadow: none;

        }

        /* ãƒãƒƒã‚¸ */

        .badges-grid {

            display: grid;

            grid-template-columns: repeat(2, 1fr);

            gap: 15px;

            padding: 20px;

        }

        .badge-card {

            background: white;

            border-radius: 20px;

            padding: 20px;

            text-align: center;

            box-shadow: 0 4px 15px rgba(0,0,0,0.05);

            border: 2px solid #ffe4e1;

        }

        .badge-card.unlocked {

            border-color: #ffd700;

            background: linear-gradient(135deg, #fffef0 0%, #fff9e6 100%);

        }

        .badge-icon {

            font-size: 48px;

            margin-bottom: 10px;

            filter: grayscale(100%);

            opacity: 0.3;

        }

        .badge-card.unlocked .badge-icon {

            filter: grayscale(0%);

            opacity: 1;

            animation: shine 2s ease infinite;

        }

        @keyframes shine {

            0%, 100% { transform: scale(1); }

            50% { transform: scale(1.1); }

        }

        .badge-name {

            font-size: 14px;

            font-weight: bold;

            color: #333;

            margin-bottom: 5px;

        }

        .badge-description {

            font-size: 11px;

            color: #999;

        }

        /* ã‚·ãƒ§ãƒƒãƒ— */

        .shop-grid {

            display: grid;

            grid-template-columns: repeat(2, 1fr);

            gap: 15px;

            padding: 20px;

        }

        .shop-item {

            background: white;

            border-radius: 20px;

            padding: 20px;

            text-align: center;

            box-shadow: 0 4px 15px rgba(0,0,0,0.05);

            border: 2px solid #ffe4e1;

            cursor: pointer;

            transition: all 0.3s ease;

        }

        .shop-item:active {

            transform: scale(0.95);

        }

        .shop-item.owned {

            border-color: #ff9a56;

            background: linear-gradient(135deg, #fff5f5 0%, #ffe4e1 100%);

        }

        .shop-icon {

            font-size: 48px;

            margin-bottom: 10px;

        }

        .shop-name {

            font-size: 14px;

            font-weight: bold;

            color: #333;

            margin-bottom: 5px;

        }

        .shop-price {

            font-size: 16px;

            color: #ff9a56;

            font-weight: bold;

        }

        /* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */

        .sparkle {

            position: fixed;

            pointer-events: none;

            font-size: 24px;

            animation: sparkleFloat 1s ease-out forwards;

            z-index: 1000;

        }

        @keyframes sparkleFloat {

            0% { transform: translate(0, 0) scale(1); opacity: 1; }

            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }

        }

        /* ãƒ•ãƒƒã‚¿ãƒ¼ */

        .footer {

            text-align: center;

            padding: 20px;

            color: #999;

            font-size: 12px;

        }

        /* ä»Šæ—¥ã®é€²æ— */

        .daily-progress {

            margin: 20px;

            padding: 20px;

            background: linear-gradient(135deg, #fff5f5 0%, #ffe4e1 100%);

            border-radius: 20px;

            text-align: center;

        }

        .daily-progress h3 {

            color: #ff6b6b;

            margin-bottom: 10px;

            font-size: 16px;

        }

        .progress-text {

            font-size: 24px;

            font-weight: bold;

            color: #ff9a56;

        }

        /* è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼‰ */
        .add-grid {
            display: grid;
            grid-template-columns: minmax(0,1.6fr) 60px 84px 96px 44px;
            gap: 8px;
            align-items: center;
            grid-template-areas:
                "name emoji points freq add";
        }
        .add-grid > * { min-width: 0; }
        .add-grid input, .add-grid select { width: 100%; }
        .add-grid .field-name { grid-area: name; }
        .add-grid .field-emoji { grid-area: emoji; }
        .add-grid .field-points { grid-area: points; }
        .add-grid .field-freq { grid-area: freq; }
        .add-grid .field-add { grid-area: add; }

        @media (max-width: 480px) {
            .add-grid {
                /* 2è¡Œæ§‹æˆ: 1è¡Œç›®=åå‰(å…¨å¹…), 2è¡Œç›®=çµµæ–‡å­—/ãƒã‚¤ãƒ³ãƒˆ/é »åº¦(åºƒã‚)/è¿½åŠ  */
                grid-template-columns: minmax(0,1fr) 64px 84px minmax(0,1fr) 44px;
                grid-template-areas:
                    "name name name name name"
                    "emoji points freq freq add";
            }
            .add-grid .field-add {
                justify-self: end;
            }
        }

    </style>

</head>

<body>

    <div id="root"></div>

    <script type="text/babel">

        const { useState, useEffect } = React;

        // æ™‚é–“å¸¯ã«å¿œã˜ãŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        function getBaseMessageByTime() {
            const hour = new Date().getHours();
            if (hour >= 5 && hour < 11) return 'ãŠã¯ã‚ˆã†ï¼ä»Šæ—¥ã‚‚é ‘å¼µã‚ã†ï¼ğŸ¯';
            if (hour >= 11 && hour < 17) return 'ã“ã‚“ã«ã¡ã¯ï¼ã„ã„ãƒšãƒ¼ã‚¹ã§ã„ã“ã†ï¼ğŸ¯';
            if (hour >= 17 && hour < 21) return 'ã“ã‚“ã°ã‚“ã¯ï¼ã‚ã¨å°‘ã—ã€ã„ã‘ã‚‹ï¼ğŸ¯';
            return 'å¤œæ›´ã‹ã—æ³¨æ„ï¼ç„¡ç†ã›ãšã­ğŸ¯';
        }

        function getBaseFaceByTime() {
            const hour = new Date().getHours();
            if (hour >= 21 || hour < 5) return 'ğŸ˜´';
            if (hour >= 5 && hour < 11) return 'ğŸ¯';
            if (hour >= 11 && hour < 17) return 'ğŸ˜º';
            return 'ğŸ˜¼';
        }

        // Audio Manager (Web Audio)
        const audioManager = (() => {
            let ctx = null;
            let musicGain = null;
            let sfxGain = null;
            let musicTimer = null;
            let started = false;
            let musicOn = false;

            const ensure = () => {
                if (!ctx) {
                    ctx = new (window.AudioContext || window.webkitAudioContext)();
                    musicGain = ctx.createGain();
                    sfxGain = ctx.createGain();
                    musicGain.gain.value = 0.15;
                    sfxGain.gain.value = 0.5;
                    musicGain.connect(ctx.destination);
                    sfxGain.connect(ctx.destination);
                }
            };

            const env = (node, startTime, attack=0.01, decay=0.2) => {
                const g = ctx.createGain();
                node.connect(g);
                g.connect(sfxGain);
                g.gain.setValueAtTime(0, startTime);
                g.gain.linearRampToValueAtTime(1, startTime + attack);
                g.gain.exponentialRampToValueAtTime(0.001, startTime + attack + decay);
                return g;
            };

            const note = (freq, when, dur=0.2, type='sine', toMusic=false) => {
                const osc = ctx.createOscillator();
                const gainNode = ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, when);
                const target = toMusic ? musicGain : sfxGain;
                osc.connect(gainNode);
                gainNode.connect(target);
                gainNode.gain.setValueAtTime(0, when);
                gainNode.gain.linearRampToValueAtTime(toMusic ? 0.3 : 1, when + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.001, when + dur);
                osc.start(when);
                osc.stop(when + dur + 0.05);
            };

            const playChime = () => {
                if (!ctx) return;
                const now = ctx.currentTime;
                // Simple major arpeggio C-E-G-C
                [523.25, 659.25, 783.99, 1046.5].forEach((f, i) => note(f, now + i*0.08, 0.18, 'triangle', false));
            };

            const startMusic = () => {
                if (!ctx) return;
                if (musicOn) return;
                musicOn = true;
                const pattern = [
                  392.00, 392.00, 440.00, 392.00, 523.25, 493.88, // cute line
                  392.00, 392.00, 440.00, 392.00, 587.33, 523.25  // variation
                ];
                const beat = 0.28;
                const loop = () => {
                    if (!musicOn) return;
                    let t = ctx.currentTime;
                    pattern.forEach((f, i) => note(f, t + i*beat, 0.22, 'sine', true));
                    musicTimer = setTimeout(loop, (pattern.length * beat) * 1000);
                };
                loop();
            };

            const stopMusic = () => {
                musicOn = false;
                if (musicTimer) { clearTimeout(musicTimer); musicTimer = null; }
            };

            return {
                init: async () => {
                    if (started) return;
                    ensure();
                    try { await ctx.resume(); } catch (e) {}
                    started = true;
                },
                playChime,
                startMusic,
                stopMusic,
                isMusicOn: () => musicOn
            };
        })();

        // åˆæœŸãƒ‡ãƒ¼ã‚¿

        const initialHabits = [

            { id: 1, name: 'æœãƒ¨ã‚¬', icon: 'ğŸ§˜â€â™€ï¸', points: 10, frequency: 'æ¯æ—¥', completed: false },

            { id: 2, name: 'ç­‹ãƒˆãƒ¬', icon: 'ğŸ’ª', points: 15, frequency: 'é€±3å›', completed: false },

            { id: 3, name: 'è‹±èª30åˆ†', icon: 'ğŸ“š', points: 20, frequency: 'æ¯æ—¥', completed: false },

            { id: 4, name: 'ã‚µãƒ—ãƒªé£²ã‚€', icon: 'ğŸ’Š', points: 5, frequency: 'æ¯æ—¥', completed: false }

        ];

        const badges = [

            { id: 1, name: '3æ—¥é€£ç¶š', icon: 'ğŸ”¥', description: '3æ—¥é€£ç¶šé”æˆ', requirement: 3 },

            { id: 2, name: '1é€±é–“', icon: 'â­', description: '7æ—¥é€£ç¶šé”æˆ', requirement: 7 },

            { id: 3, name: '1ãƒ¶æœˆ', icon: 'ğŸ’', description: '30æ—¥é€£ç¶šé”æˆ', requirement: 30 },

            { id: 4, name: '100å›é”æˆ', icon: 'ğŸ‘‘', description: 'ç´¯è¨ˆ100å›é”æˆ', requirement: 100 }

        ];

        const shopItems = [

            { id: 1, name: 'ç‹å† ', icon: 'ğŸ‘‘', price: 50 },

            { id: 2, name: 'ã‚µãƒ³ã‚°ãƒ©ã‚¹', icon: 'ğŸ•¶ï¸', price: 30 },

            { id: 3, name: 'ãƒªãƒœãƒ³', icon: 'ğŸ€', price: 40 },

            { id: 4, name: 'èŠ±å† ', icon: 'ğŸŒ¸', price: 60 }

        ];

        function App() {

            const [activeTab, setActiveTab] = useState('habits');

            const [habits, setHabits] = useState([]);

            const [level, setLevel] = useState(1);

            const [exp, setExp] = useState(0);

            const [coins, setCoins] = useState(0);

            const [streak, setStreak] = useState(0);

            const [totalCompleted, setTotalCompleted] = useState(0);

            const [unlockedBadges, setUnlockedBadges] = useState([]);

            const [ownedItems, setOwnedItems] = useState([]);

            const [tigerMessage, setTigerMessage] = useState(getBaseMessageByTime());

            const [celebrating, setCelebrating] = useState(false);
            const [tigerFace, setTigerFace] = useState(getBaseFaceByTime());

            const [musicEnabled, setMusicEnabled] = useState(false);
            // æ–°è¦ç¿’æ…£ãƒ•ã‚©ãƒ¼ãƒ 
            const [newName, setNewName] = useState('');
            const [newIcon, setNewIcon] = useState('ğŸ¯');
            const [newPoints, setNewPoints] = useState(10);
            const [newFreq, setNewFreq] = useState('æ¯æ—¥');

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿

            useEffect(() => {

                const saved = localStorage.getItem('yokosGarden');
                const today = new Date().toDateString(); // æ—¥ä»˜æ–‡å­—åˆ—ï¼ˆä¾‹: "Mon Nov 07 2024"ï¼‰
                const lastResetDate = localStorage.getItem('yg_lastResetDate');

                if (saved) {

                    const data = JSON.parse(saved);

                    // æ—¥ä»˜ãŒå¤‰ã‚ã£ã¦ã„ãŸã‚‰ç¿’æ…£ã®å®Œäº†çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                    if (lastResetDate !== today) {
                        // ãƒªã‚»ãƒƒãƒˆå‰ã«æ˜¨æ—¥ã®å®Œäº†çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆé€£ç¶šæ—¥æ•°ã®æ›´æ–°ç”¨ï¼‰
                        const yesterdayCompleted = data.habits && data.habits.some(h => h.completed);
                        
                        // ç¿’æ…£ã®completedã‚’falseã«ãƒªã‚»ãƒƒãƒˆ
                        const resetHabits = (data.habits || initialHabits).map(h => ({
                            ...h,
                            completed: false
                        }));
                        setHabits(resetHabits);
                        
                        // é€£ç¶šæ—¥æ•°ã®æ›´æ–°ï¼ˆæ˜¨æ—¥ç¿’æ…£ã‚’å®Œäº†ã—ã¦ã„ãŸã‚‰é€£ç¶šã€ãã†ã§ãªã‘ã‚Œã°0ã«ï¼‰
                        if (yesterdayCompleted) {
                            setStreak((data.streak || 0) + 1);
                        } else {
                            setStreak(0);
                        }
                        
                        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ä¿å­˜
                        localStorage.setItem('yg_lastResetDate', today);
                    } else {
                        setHabits(data.habits || initialHabits);
                        setStreak(data.streak || 0);
                    }

                    setLevel(data.level || 1);

                    setExp(data.exp || 0);

                    setCoins(data.coins || 0);

                    setTotalCompleted(data.totalCompleted || 0);

                    setUnlockedBadges(data.unlockedBadges || []);

                    setOwnedItems(data.ownedItems || []);

                } else {

                    setHabits(initialHabits);
                    localStorage.setItem('yg_lastResetDate', today);

                }

                const pref = localStorage.getItem('yg_music');
                if (pref === 'on') setMusicEnabled(true);

            }, []);

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜

            useEffect(() => {

                const data = {

                    habits,

                    level,

                    exp,

                    coins,

                    streak,

                    totalCompleted,

                    unlockedBadges,

                    ownedItems

                };

                localStorage.setItem('yokosGarden', JSON.stringify(data));

            }, [habits, level, exp, coins, streak, totalCompleted, unlockedBadges, ownedItems]);

            // Music preference side-effect
            useEffect(() => {
                localStorage.setItem('yg_music', musicEnabled ? 'on' : 'off');
            }, [musicEnabled]);

            const expForNextLevel = level * 50;

            const expPercentage = (exp / expForNextLevel) * 100;

            const completedToday = habits.filter(h => h.completed).length;

            const totalHabits = habits.length;

            // ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ã®ãƒˆã‚°ãƒ«ï¼ˆåˆå›ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§åˆæœŸåŒ–ï¼‰
            const toggleMusic = async () => {
                await audioManager.init();
                if (audioManager.isMusicOn()) {
                    audioManager.stopMusic();
                    setMusicEnabled(false);
                } else {
                    audioManager.startMusic();
                    setMusicEnabled(true);
                }
            };

            // ç¿’æ…£è¿½åŠ 
            const addHabit = (e) => {
                e.preventDefault();
                const name = newName.trim();
                if (!name) return;
                const nextId = (habits.reduce((m, h) => Math.max(m, Number(h.id) || 0), 0) + 1) || 1;
                const created = {
                    id: nextId,
                    name,
                    icon: newIcon || 'ğŸ¯',
                    points: Math.max(1, Number(newPoints) || 1),
                    frequency: newFreq || 'æ¯æ—¥',
                    completed: false
                };
                setHabits([ ...habits, created ]);
                setNewName('');
                setNewIcon('ğŸ¯');
                setNewPoints(10);
                setNewFreq('æ¯æ—¥');
            };

            // ç¿’æ…£å‰Šé™¤
            const deleteHabit = (habitId) => {
                const target = habits.find(h => h.id === habitId);
                if (!target) return;
                if (!confirm(`ã€Œ${target.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
                setHabits(habits.filter(h => h.id !== habitId));
            };

            // ç¿’æ…£å®Œäº†

            const completeHabit = async (habitId) => {

                const habit = habits.find(h => h.id === habitId);

                if (habit.completed) return;

                // ã‚­ãƒ©ã‚­ãƒ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

                createSparkles();

                // ã‚µã‚¦ãƒ³ãƒ‰
                await audioManager.init();
                audioManager.playChime();

                // ç¿’æ…£ã‚’å®Œäº†çŠ¶æ…‹ã«

                const newHabits = habits.map(h =>

                    h.id === habitId ? { ...h, completed: true } : h

                );

                setHabits(newHabits);

                // çµŒé¨“å€¤ã¨ã‚³ã‚¤ãƒ³è¿½åŠ 

                let newExp = exp + habit.points;

                let newCoins = coins + Math.floor(habit.points / 2);

                let newLevel = level;

                // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯

                while (newExp >= newLevel * 50) {

                    newExp -= newLevel * 50;

                    newLevel++;

                    setTigerMessage('ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼å¼·ããªã£ãŸã‚ˆï¼');
                    setTigerFace('ğŸ¤©');

                    setTimeout(() => { setTigerMessage(getBaseMessageByTime()); setTigerFace(getBaseFaceByTime()); }, 3000);

                }

                setExp(newExp);

                setCoins(newCoins);

                setLevel(newLevel);

                setTotalCompleted(totalCompleted + 1);

                // è™ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³

                setCelebrating(true);

                setTimeout(() => setCelebrating(false), 500);

                const messages = [

                    'ã‚„ã£ãŸãƒ¼ï¼å¬‰ã—ã„ï¼ğŸ¯',

                    'ã™ã”ã„ï¼ãã®èª¿å­ï¼âœ¨',

                    'å®Œç’§ï¼ä¸€ç·’ã«é ‘å¼µã‚ã†ï¼ğŸ’ª',

                    'ã•ã™ãŒYOKOã•ã‚“ï¼ğŸ”¥',

                    'é™ç•Œçªç ´ã ï¼ğŸŒŸ'

                ];

                setTigerMessage(messages[Math.floor(Math.random() * messages.length)]);
                setTigerFace('ğŸ˜¸');

                setTimeout(() => { setTigerMessage(getBaseMessageByTime()); setTigerFace(getBaseFaceByTime()); }, 3000);

                // ãƒãƒƒã‚¸ãƒã‚§ãƒƒã‚¯

                checkBadges(streak + 1, totalCompleted + 1);

            };

            // ã‚­ãƒ©ã‚­ãƒ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

            const createSparkles = () => {

                for (let i = 0; i < 10; i++) {

                    setTimeout(() => {

                        const sparkle = document.createElement('div');

                        sparkle.className = 'sparkle';

                        sparkle.textContent = ['âœ¨', 'â­', 'ğŸ’«', 'ğŸŒŸ'][Math.floor(Math.random() * 4)];

                        sparkle.style.left = `${Math.random() * window.innerWidth}px`;

                        sparkle.style.top = `${Math.random() * window.innerHeight}px`;

                        sparkle.style.setProperty('--tx', `${(Math.random() - 0.5) * 100}px`);

                        sparkle.style.setProperty('--ty', `${-50 - Math.random() * 50}px`);

                        document.body.appendChild(sparkle);

                        setTimeout(() => sparkle.remove(), 1000);

                    }, i * 100);

                }

            };

            // ãƒãƒƒã‚¸ãƒã‚§ãƒƒã‚¯

            const checkBadges = (currentStreak, currentTotal) => {

                badges.forEach(badge => {

                    if (!unlockedBadges.includes(badge.id)) {

                        if ((badge.id <= 3 && currentStreak >= badge.requirement) ||

                            (badge.id === 4 && currentTotal >= badge.requirement)) {

                            setUnlockedBadges([...unlockedBadges, badge.id]);

                            setTigerMessage(`ğŸ‰ ãƒãƒƒã‚¸ç²å¾—ï¼ã€Œ${badge.name}ã€ï¼`);

                        }

                    }

                });

            };

            // ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥

            const buyItem = (item) => {

                if (ownedItems.includes(item.id)) {

                    setTigerMessage('ã‚‚ã†æŒã£ã¦ã‚‹ã‚ˆï¼');

                    return;

                }

                if (coins >= item.price) {

                    setCoins(coins - item.price);

                    setOwnedItems([...ownedItems, item.id]);

                    setTigerMessage(`âœ¨ ${item.name}ã‚’æ‰‹ã«å…¥ã‚ŒãŸï¼`);
                    setTigerFace('ğŸ˜');

                    createSparkles();

                } else {

                    setTigerMessage('ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šãªã„ã‚ˆ...é ‘å¼µã‚ã†ï¼');

                }

                setTimeout(() => { setTigerMessage(getBaseMessageByTime()); setTigerFace(getBaseFaceByTime()); }, 3000);

            };

            // æ‰‹å‹•ãƒªã‚»ãƒƒãƒˆï¼ˆç¿’æ…£ã®å®Œäº†çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆï¼‰
            const resetDailyHabits = () => {
                if (!confirm('ä»Šæ—¥ã®ç¿’æ…£ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå®Œäº†çŠ¶æ…‹ã®ã¿ãƒªã‚»ãƒƒãƒˆã•ã‚Œã€ãƒ¬ãƒ™ãƒ«ã‚„ã‚³ã‚¤ãƒ³ã€é€£ç¶šæ—¥æ•°ã¯ä¿æŒã•ã‚Œã¾ã™ï¼‰')) {
                    return;
                }
                
                // ç¾åœ¨ã®é€£ç¶šæ—¥æ•°ã‚’ä¿å­˜ï¼ˆæ‰‹å‹•ãƒªã‚»ãƒƒãƒˆã§ã¯é€£ç¶šæ—¥æ•°ã‚’ä¿æŒï¼‰
                const currentStreak = streak;
                
                const resetHabits = habits.map(h => ({
                    ...h,
                    completed: false
                }));
                setHabits(resetHabits);
                
                // é€£ç¶šæ—¥æ•°ã‚’æ˜ç¤ºçš„ã«ä¿æŒï¼ˆå¤‰æ›´ã—ãªã„ï¼‰
                setStreak(currentStreak);
                
                // ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ›´æ–°ï¼ˆè‡ªå‹•ãƒªã‚»ãƒƒãƒˆã‚’é˜²ããŸã‚ï¼‰
                const today = new Date().toDateString();
                localStorage.setItem('yg_lastResetDate', today);
                
                setTigerMessage('ãƒªã‚»ãƒƒãƒˆå®Œäº†ï¼ä»Šæ—¥ã‚‚é ‘å¼µã‚ã†ï¼ğŸ¯');
                setTigerFace('ğŸ˜º');
                setTimeout(() => { setTigerMessage(getBaseMessageByTime()); setTigerFace(getBaseFaceByTime()); }, 3000);
            };

            return (

                <div>

                    {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}

                    <div className="header">

                        <h1>ğŸ¯ YOKO's Garden</h1>

                        <div style={{ position: 'absolute', right: '12px', top: '12px', display: 'flex', flexDirection: 'column', gap: '6px', zIndex: 10 }}>
                            <button className="music-toggle" onClick={toggleMusic} style={{ position: 'static' }}>
                                {musicEnabled ? 'â™ª éŸ³æ¥½ON' : 'â™ª éŸ³æ¥½OFF'}
                            </button>
                            <button 
                                className="music-toggle" 
                                onClick={resetDailyHabits}
                                style={{ position: 'static', fontSize: '11px', padding: '6px 10px' }}
                            >
                                ğŸ”„ ãƒªã‚»ãƒƒãƒˆ
                            </button>
                        </div>

                        <div className="stats-container">

                            <div className="stat-box">

                                <div className="stat-label">ãƒ¬ãƒ™ãƒ«</div>

                                <div className="stat-value">{level}</div>

                            </div>

                            <div className="stat-box">

                                <div className="stat-label">ã‚³ã‚¤ãƒ³</div>

                                <div className="stat-value">{coins}</div>

                            </div>

                            <div className="stat-box">

                                <div className="stat-label">é€£ç¶š</div>

                                <div className="stat-value">{streak}æ—¥</div>

                            </div>

                        </div>

                    </div>

                    {/* è™ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ */}

                    <div className="tiger-container">

                        <div className={`tiger ${celebrating ? 'celebrating' : ''}`}>

                            {tigerFace}

                            {ownedItems.includes(1) && <span style={{position: 'absolute', marginLeft: '-60px', marginTop: '-20px'}}>ğŸ‘‘</span>}

                            {ownedItems.includes(2) && <span style={{position: 'absolute', marginLeft: '-40px', marginTop: '10px'}}>ğŸ•¶ï¸</span>}

                        </div>

                        <div className="tiger-message">{tigerMessage}</div>

                        <div className="level-badge">Lv.{level} ã‚¿ã‚¤ã‚¬ãƒ¼æˆ¦å£«</div>

                    </div>

                    {/* çµŒé¨“å€¤ãƒãƒ¼ */}

                    <div className="exp-bar-container">

                        <div className="exp-bar" style={{ width: `${expPercentage}%` }}>

                            {exp} / {expForNextLevel} EXP

                        </div>

                    </div>

                    {/* ä»Šæ—¥ã®é€²æ— */}

                    {activeTab === 'habits' && (

                        <div className="daily-progress">

                            <h3>ä»Šæ—¥ã®é€²æ—</h3>

                            <div className="progress-text">{completedToday} / {totalHabits}</div>

                        </div>

                    )}

                    {/* ã‚¿ãƒ– */}

                    <div className="tabs">

                        <button className={`tab ${activeTab === 'habits' ? 'active' : ''}`} onClick={() => setActiveTab('habits')}>

                            ç¿’æ…£

                        </button>

                        <button className={`tab ${activeTab === 'badges' ? 'active' : ''}`} onClick={() => setActiveTab('badges')}>

                            ãƒãƒƒã‚¸

                        </button>

                        <button className={`tab ${activeTab === 'shop' ? 'active' : ''}`} onClick={() => setActiveTab('shop')}>

                            ã‚·ãƒ§ãƒƒãƒ—

                        </button>

                    </div>

                    {/* ç¿’æ…£ã‚¿ãƒ– */}

                    {activeTab === 'habits' && (

                        <div className="habits-list">

                            {/* è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */}
                            <form onSubmit={addHabit} style={{
                                background: '#fff5f5',
                                border: '2px solid #ffe4e1',
                                borderRadius: 16,
                                padding: 16,
                                marginBottom: 16
                            }}>
                                <div className="add-grid">
                                    <input
                                        type="text"
                                        placeholder="ç¿’æ…£åï¼ˆä¾‹ï¼šæœãƒ¨ã‚¬ï¼‰"
                                        value={newName}
                                        onChange={e => setNewName(e.target.value)}
                                        className="field-name"
                                        style={{ height: 40, padding: '0 12px', borderRadius: 12, border: '2px solid #ffe4e1' }}
                                    />
                                    <input
                                        type="text"
                                        placeholder="çµµæ–‡å­—"
                                        value={newIcon}
                                        maxLength={2}
                                        onChange={e => setNewIcon(e.target.value)}
                                        className="field-emoji"
                                        style={{ height: 40, padding: '0 12px', borderRadius: 12, border: '2px solid #ffe4e1', textAlign: 'center' }}
                                    />
                                    <input
                                        type="number"
                                        min={1}
                                        max={100}
                                        value={newPoints}
                                        onChange={e => setNewPoints(e.target.value)}
                                        className="field-points"
                                        style={{ height: 40, padding: '0 12px', borderRadius: 12, border: '2px solid #ffe4e1' }}
                                    />
                                    <select
                                        value={newFreq}
                                        onChange={e => setNewFreq(e.target.value)}
                                        className="field-freq"
                                        style={{ height: 40, padding: '0 12px', borderRadius: 12, border: '2px solid #ffe4e1', background: 'white' }}
                                    >
                                        <option>æ¯æ—¥</option>
                                        <option>é€±3å›</option>
                                        <option>é€±5å›</option>
                                        <option>å¹³æ—¥</option>
                                    </select>
                                    <button
                                        type="submit"
                                        aria-label="ç¿’æ…£ã‚’è¿½åŠ "
                                        title="è¿½åŠ "
                                        className="field-add"
                                        style={{
                                            width: 40,
                                            height: 40,
                                            borderRadius: 20,
                                            border: 'none',
                                            background: 'linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%)',
                                            color: '#fff',
                                            fontWeight: 700,
                                            boxShadow: '0 4px 10px rgba(255, 107, 107, 0.3)',
                                            cursor: 'pointer',
                                            display: 'grid',
                                            placeItems: 'center'
                                        }}
                                    >
                                        ï¼‹
                                    </button>
                                </div>
                            </form>

                            {habits.map(habit => (

                                <div key={habit.id} className={`habit-card ${habit.completed ? 'completed' : ''}`}>

                                    <div className="habit-header">

                                        <div className="habit-icon">{habit.icon}</div>

                                        <div className="habit-info">

                                            <div className="habit-name">{habit.name}</div>

                                            <div className="habit-frequency">{habit.frequency}</div>

                                        </div>

                                    </div>

                                    <div className="habit-footer">

                                        <div className="habit-points">+{habit.points} EXP</div>

                                        <button

                                            className={`check-button ${habit.completed ? 'completed' : ''}`}

                                            onClick={() => completeHabit(habit.id)}

                                            disabled={habit.completed}

                                        >

                                            {habit.completed ? 'âœ“ å®Œäº†' : 'é”æˆï¼'}

                                        </button>

                                        <button
                                            onClick={() => deleteHabit(habit.id)}
                                            className="check-button"
                                            style={{ background: '#ddd', color: '#666' }}
                                        >
                                            ğŸ—‘ï¸ å‰Šé™¤
                                        </button>

                                    </div>

                                </div>

                            ))}

                        </div>

                    )}

                    {/* ãƒãƒƒã‚¸ã‚¿ãƒ– */}

                    {activeTab === 'badges' && (

                        <div className="badges-grid">

                            {badges.map(badge => (

                                <div key={badge.id} className={`badge-card ${unlockedBadges.includes(badge.id) ? 'unlocked' : ''}`}>

                                    <div className="badge-icon">{badge.icon}</div>

                                    <div className="badge-name">{badge.name}</div>

                                    <div className="badge-description">{badge.description}</div>

                                </div>

                            ))}

                        </div>

                    )}

                    {/* ã‚·ãƒ§ãƒƒãƒ—ã‚¿ãƒ– */}

                    {activeTab === 'shop' && (

                        <div className="shop-grid">

                            {shopItems.map(item => (

                                <div

                                    key={item.id}

                                    className={`shop-item ${ownedItems.includes(item.id) ? 'owned' : ''}`}

                                    onClick={() => buyItem(item)}

                                >

                                    <div className="shop-icon">{item.icon}</div>

                                    <div className="shop-name">{item.name}</div>

                                    <div className="shop-price">

                                        {ownedItems.includes(item.id) ? 'æ‰€æŒä¸­' : `${item.price} ã‚³ã‚¤ãƒ³`}

                                    </div>

                                </div>

                            ))}

                        </div>

                    )}

                    {/* ãƒ•ãƒƒã‚¿ãƒ¼ */}

                    <div className="footer">

                        Push Your Limits! ğŸ¯âœ¨<br/>

                        é™ç•Œã‚’è¶Šãˆã‚‹ã€ä»²é–“ã¨å…±ã«ãã®å…ˆã¸

                    </div>

                </div>

            );

        }

        ReactDOM.render(<App />, document.getElementById('root'));

    </script>

</body>

</html>


